<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InkFlow Studio | Advanced Pixel Art</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-bg: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            --panel-bg: rgba(18, 18, 30, 0.85);
            --accent-purple: #8a2be2;
            --accent-blue: #4fc3f7;
            --accent-green: #27ae60;
            --accent-red: #e74c3c;
            --accent-orange: #f39c12;
            --text-light: #e0e0ff;
            --text-secondary: #b0b0ff;
            --border-color: rgba(100, 100, 255, 0.2);
            --transition-speed: 0.3s;
        }

        body {
            background: var(--primary-bg);
            color: var(--text-light);
            font-family: 'Segoe UI', 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            transition: background var(--transition-speed), color var(--transition-speed);
        }

        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            .navbar {
                padding: 10px 15px;
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }
            
            .nav-links a {
                padding: 6px 10px;
                font-size: 0.9rem;
            }
            
            .main-container {
                flex-direction: column;
                padding: 0 10px;
                gap: 15px;
            }
            
            .studio-content {
                flex-direction: column;
                height: auto;
            }
            
            .tools-section {
                width: 100%;
                order: -1;
            }
            
            .reference-panel {
                width: 100%;
            }
            
            .canvas-section {
                min-height: 400px;
            }
            
            .brush-types {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .gallery-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .profile-info {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .profile-stats {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .stat-item {
                min-width: 120px;
            }
        }

        @media (max-width: 480px) {
            .logo h1 {
                font-size: 1.4rem;
            }
            
            .user-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .profile-stats {
                flex-direction: column;
                align-items: center;
            }
            
            .artwork-interactions {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Rest of your existing CSS styles would go here */
        /* I'll include the key styles for functionality */
        
        .navbar {
            background: rgba(18, 18, 30, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .main-container {
            max-width: 1600px;
            margin: 20px auto;
            padding: 0 20px;
            display: flex;
            gap: 25px;
        }

        .content-section {
            flex: 1;
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
            overflow: hidden;
            border: 1px solid var(--border-color);
            padding: 25px;
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .studio-content {
            display: flex;
            gap: 25px;
            height: calc(100vh - 200px);
        }

        .canvas-container {
            flex: 1;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5);
            border: 2px solid #33334d;
            background: #1a1a2e;
        }

        #drawing-canvas {
            width: 100%;
            height: 100%;
            display: block;
            cursor: crosshair;
        }

        .tools-section {
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .tool-group {
            background: rgba(30, 30, 50, 0.75);
            border-radius: 14px;
            padding: 20px;
            border: 1px solid rgba(100, 100, 255, 0.25);
        }

        .symmetry-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .symmetry-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: background var(--transition-speed);
        }

        .symmetry-option:hover {
            background: rgba(60, 60, 100, 0.5);
        }

        .symmetry-option.active {
            background: rgba(79, 195, 247, 0.2);
        }

        /* Add more essential styles as needed */
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-palette"></i>
            <h1>InkFlow Studio</h1>
        </div>
        <div class="nav-links">
            <a href="#" class="active" data-section="studio"><i class="fas fa-draw-polygon"></i> Studio</a>
            <a href="#" data-section="community"><i class="fas fa-users"></i> Community</a>
            <a href="#" data-section="profile"><i class="fas fa-user"></i> Profile</a>
            <a href="#" data-section="settings"><i class="fas fa-cog"></i> Settings</a>
        </div>
        <div class="user-actions" id="user-actions">
            <div id="auth-buttons">
                <button class="btn" id="login-btn"><i class="fas fa-sign-in-alt"></i> Login</button>
                <button class="btn btn-upload" id="register-btn"><i class="fas fa-user-plus"></i> Register</button>
            </div>
            <div id="user-info" style="display: none;">
                <div class="user-info" id="profile-btn">
                    <div class="user-avatar" id="user-avatar">
                        <span id="avatar-initial">U</span>
                    </div>
                    <span id="username-display">User</span>
                </div>
                <button class="btn btn-clear" id="logout-btn"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Studio Section -->
        <div class="content-section active" id="studio-section">
            <div class="section-header">
                <h2><i class="fas fa-draw-polygon"></i> Pixel Art Studio</h2>
            </div>
            <div class="studio-content">
                <div class="canvas-section">
                    <div class="canvas-container">
                        <canvas id="drawing-canvas"></canvas>
                    </div>
                </div>

                <div class="tools-section">
                    <div class="tool-group">
                        <h3><i class="fas fa-fill-drip"></i> Color</h3>
                        <div class="color-picker">
                            <input type="color" id="color-picker" value="#ff6b6b">
                        </div>
                    </div>

                    <div class="tool-group">
                        <h3><i class="fas fa-sliders-h"></i> Controls</h3>
                        <div class="slider-container">
                            <i class="fas fa-ruler-combined"></i>
                            <input type="range" id="brush-size" min="1" max="40" value="10">
                            <span class="slider-value" id="brush-size-value">10px</span>
                        </div>
                        <div class="controls">
                            <button class="btn btn-clear" id="clear-btn"><i class="fas fa-broom"></i> Clear</button>
                            <button class="btn btn-undo" id="undo-btn"><i class="fas fa-undo-alt"></i> Undo</button>
                            <button class="btn btn-download" id="download-btn"><i class="fas fa-file-download"></i> Download</button>
                        </div>
                    </div>

                    <div class="tool-group">
                        <h3><i class="fas fa-snowflake"></i> Symmetry</h3>
                        <div class="symmetry-controls">
                            <div class="symmetry-option active" data-symmetry="none">
                                <i class="fas fa-ban"></i>
                                <span>None</span>
                            </div>
                            <div class="symmetry-option" data-symmetry="vertical">
                                <i class="fas fa-grip-lines-vertical"></i>
                                <span>Vertical</span>
                            </div>
                            <div class="symmetry-option" data-symmetry="horizontal">
                                <i class="fas fa-grip-lines"></i>
                                <span>Horizontal</span>
                            </div>
                            <div class="symmetry-option" data-symmetry="radial">
                                <i class="fas fa-circle"></i>
                                <span>Radial</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Community Section -->
        <div class="content-section" id="community-section">
            <div class="section-header">
                <h2><i class="fas fa-users"></i> Community Gallery</h2>
            </div>
            <div class="gallery-grid" id="gallery-grid">
                <!-- Artwork will be loaded dynamically -->
            </div>
        </div>

        <!-- Profile Section -->
        <div class="content-section" id="profile-section">
            <div class="section-header">
                <h2><i class="fas fa-user"></i> Your Profile</h2>
            </div>
            <div class="profile-container">
                <!-- Profile content will be here -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Canvas elements
            const canvas = document.getElementById('drawing-canvas');
            const ctx = canvas.getContext('2d');
            const colorPicker = document.getElementById('color-picker');
            const brushSizeSlider = document.getElementById('brush-size');
            const brushSizeValue = document.getElementById('brush-size-value');
            const clearBtn = document.getElementById('clear-btn');
            const undoBtn = document.getElementById('undo-btn');
            const downloadBtn = document.getElementById('download-btn');
            const symmetryOptions = document.querySelectorAll('.symmetry-option');

            // Drawing state
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            let currentColor = '#ff6b6b';
            let brushSize = 10;
            let symmetryType = 'none'; // FIXED: Default to none instead of vertical
            let history = [];
            let historyPointer = -1;

            // Initialize canvas
            function initCanvas() {
                resizeCanvas();
                initEventListeners();
                updateUserUI();
                renderCommunityGallery();
            }

            // Initialize event listeners
            function initEventListeners() {
                // Canvas events
                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('mouseup', stopDrawing);
                canvas.addEventListener('mouseout', stopDrawing);

                // Touch events for mobile drawing
                canvas.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    startDrawing(e.touches[0]);
                });

                canvas.addEventListener('touchmove', function(e) {
                    e.preventDefault();
                    draw(e.touches[0]);
                });

                canvas.addEventListener('touchend', stopDrawing);

                // Color selection
                colorPicker.addEventListener('input', function() {
                    currentColor = this.value;
                });

                // Brush size
                brushSizeSlider.addEventListener('input', function() {
                    brushSize = this.value;
                    brushSizeValue.textContent = brushSize + 'px';
                });

                // Symmetry selection - FIXED: Properly initialize symmetry
                symmetryOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        symmetryOptions.forEach(opt => opt.classList.remove('active'));
                        this.classList.add('active');
                        symmetryType = this.dataset.symmetry;
                    });
                });

                // Clear canvas
                clearBtn.addEventListener('click', function() {
                    clearCanvas();
                    saveState();
                });

                // Undo
                undoBtn.addEventListener('click', undo);

                // Download artwork
                downloadBtn.addEventListener('click', function() {
                    downloadArtwork();
                });
            }

            // Set canvas dimensions
            function resizeCanvas() {
                const container = document.querySelector('.canvas-container');
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                saveState();
            }

            // Start drawing
            function startDrawing(e) {
                isDrawing = true;
                const pos = getCanvasMousePos(canvas, e);
                [lastX, lastY] = [pos.x, pos.y];
            }

            // Draw function
            function draw(e) {
                if (!isDrawing) return;
                const pos = getCanvasMousePos(canvas, e);
                const x = pos.x;
                const y = pos.y;

                ctx.strokeStyle = currentColor;
                ctx.lineWidth = brushSize;
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();

                // Apply symmetry if enabled
                if (symmetryType !== 'none') {
                    const symmetricPoint = applySymmetry(x, y);
                    if (symmetricPoint) {
                        ctx.beginPath();
                        ctx.moveTo(symmetricPoint.x, symmetricPoint.y);
                        ctx.lineTo(symmetricPoint.x, symmetricPoint.y);
                        ctx.stroke();
                    }
                }

                [lastX, lastY] = [x, y];
            }

            // Stop drawing
            function stopDrawing() {
                if (isDrawing) {
                    isDrawing = false;
                    saveState();
                }
            }

            // Apply symmetry
            function applySymmetry(x, y) {
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;

                switch(symmetryType) {
                    case 'vertical':
                        return { x: canvas.width - x, y: y };
                    case 'horizontal':
                        return { x: x, y: canvas.height - y };
                    case 'radial':
                        return { 
                            x: centerX + (centerX - x), 
                            y: centerY + (centerY - y) 
                        };
                    default:
                        return null;
                }
            }

            // Clear canvas
            function clearCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            // Save current state to history
            function saveState() {
                historyPointer++;
                if (historyPointer < history.length) {
                    history = history.slice(0, historyPointer);
                }

                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                history.push(imageData);

                if (history.length > 20) {
                    history.shift();
                    historyPointer--;
                }
            }

            // Undo functionality
            function undo() {
                if (historyPointer > 0) {
                    historyPointer--;
                    ctx.putImageData(history[historyPointer], 0, 0);
                }
            }

            // Download artwork
            function downloadArtwork() {
                const link = document.createElement('a');
                link.download = 'inkflow-art.png';
                link.href = canvas.toDataURL();
                link.click();
            }

            // Helper function to get accurate canvas coordinates
            function getCanvasMousePos(canvas, evt) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                return {
                    x: (evt.clientX - rect.left) * scaleX,
                    y: (evt.clientY - rect.top) * scaleY
                };
            }

            // User system
            let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
            let users = JSON.parse(localStorage.getItem('inkflowUsers')) || [];
            let communityArtworks = JSON.parse(localStorage.getItem('inkflowCommunity')) || [];

            // Update user UI
            function updateUserUI() {
                const authButtons = document.getElementById('auth-buttons');
                const userInfo = document.getElementById('user-info');
                const usernameDisplay = document.getElementById('username-display');
                const avatarInitial = document.getElementById('avatar-initial');

                if (currentUser) {
                    authButtons.style.display = 'none';
                    userInfo.style.display = 'flex';
                    usernameDisplay.textContent = currentUser.username;
                    avatarInitial.textContent = currentUser.username.charAt(0).toUpperCase();
                } else {
                    authButtons.style.display = 'flex';
                    userInfo.style.display = 'none';
                }
            }

            // Render community gallery
            function renderCommunityGallery() {
                const galleryGrid = document.getElementById('gallery-grid');
                galleryGrid.innerHTML = '';

                communityArtworks.forEach(artwork => {
                    const artworkCard = document.createElement('div');
                    artworkCard.className = 'artwork-card';
                    artworkCard.innerHTML = `
                        <img src="${artwork.image}" alt="${artwork.title}" class="artwork-image">
                        <div class="artwork-info">
                            <h3 class="artwork-title">${artwork.title}</h3>
                            <div class="profile-author">By ${artwork.author}</div>
                            <div class="artwork-stats">
                                <div class="stat"><i class="fas fa-heart"></i> ${artwork.likes}</div>
                                <div class="stat"><i class="fas fa-comment"></i> ${artwork.comments}</div>
                            </div>
                        </div>
                    `;
                    galleryGrid.appendChild(artworkCard);
                });
            }

            // Initialize the application
            window.addEventListener('resize', resizeCanvas);
            initCanvas();
        });
    </script>
</body>
</html>
