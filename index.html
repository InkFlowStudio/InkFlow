<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InkFlow Studio | Advanced Pixel Art</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #6c5ce7;
            --primary-dark: #5649c0;
            --secondary: #fd79a8;
            --dark: #2d3436;
            --darker: #1e272e;
            --light: #f5f6fa;
            --gray: #a4b0be;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #e84393;
        }

        body {
            background-color: var(--darker);
            color: var(--light);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background-color: var(--dark);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--primary);
            font-size: 1.8rem;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 5px;
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--gray);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn.active, .nav-btn:hover {
            background-color: rgba(108, 92, 231, 0.2);
            color: var(--primary);
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #e84393;
        }

        .btn-outline {
            background: none;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: rgba(108, 92, 231, 0.1);
        }

        /* Main Content */
        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--dark);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
        }

        .tool-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .tool-group h3 {
            font-size: 1rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-group h3 i {
            color: var(--primary);
        }

        .color-picker {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #color-picker {
            width: 100%;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .preset-colors {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .preset-color {
            aspect-ratio: 1;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid transparent;
        }

        .preset-color.active, .preset-color:hover {
            transform: scale(1.1);
            border-color: white;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-container i {
            color: var(--primary);
            width: 20px;
        }

        .slider-container input {
            flex: 1;
        }

        .slider-value {
            min-width: 40px;
            text-align: right;
            font-size: 0.9rem;
        }

        .brush-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
            padding: 5px;
        }

        .brush-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 5px;
            background-color: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 8px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.2s;
        }

        .brush-btn.active, .brush-btn:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
        }

        .brush-icon {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .brush-name {
            font-size: 0.7rem;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .controls .btn {
            flex: 1;
            justify-content: center;
            font-size: 0.8rem;
            padding: 8px 5px;
        }

        .hotkey-hint {
            font-size: 0.7rem;
            color: var(--gray);
            margin-top: 10px;
            text-align: center;
        }

        /* Canvas Area */
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
            overflow: hidden;
        }

        .canvas-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .canvas-container {
            flex: 1;
            background-color: var(--dark);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #drawing-canvas {
            background-color: white;
            cursor: crosshair;
            display: block;
        }

        .zoom-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: rgba(45, 52, 54, 0.8);
            border-radius: 8px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .zoom-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary);
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            color: white;
            border: none;
        }

        .zoom-btn:hover {
            background-color: var(--primary-dark);
        }

        .zoom-display {
            font-size: 0.8rem;
            font-weight: bold;
        }

        .canvas-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .canvas-info {
            display: flex;
            gap: 15px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--dark);
            border-radius: 10px;
            padding: 25px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.2rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: var(--light);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: var(--light);
            font-size: 1rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.3s ease-out;
            display: none;
        }

        .notification.error {
            background-color: var(--danger);
        }

        .notification.warning {
            background-color: var(--warning);
            color: var(--dark);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .nav-links {
                display: none;
            }
            
            .logo h1 {
                font-size: 1.2rem;
            }
            
            .brush-types {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">
            <i class="fas fa-paint-brush"></i>
            <h1>InkFlow Studio</h1>
        </div>
        <div class="nav-links">
            <button class="nav-btn active"><i class="fas fa-draw-polygon"></i> Canvas</button>
            <button class="nav-btn"><i class="fas fa-palette"></i> Gallery</button>
            <button class="nav-btn"><i class="fas fa-cog"></i> Settings</button>
        </div>
        <div class="user-actions">
            <button class="btn btn-outline" id="login-btn">Login</button>
            <button class="btn btn-primary" id="register-btn">Sign Up</button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="tool-group">
                <h3><i class="fas fa-fill-drip"></i> Color</h3>
                <div class="color-picker">
                    <input type="color" id="color-picker" value="#6c5ce7">
                    <div class="preset-colors">
                        <div class="preset-color active" style="background-color: #ff6b6b;" data-color="#ff6b6b"></div>
                        <div class="preset-color" style="background-color: #4fc3f7;" data-color="#4fc3f7"></div>
                        <div class="preset-color" style="background-color: #8a2be2;" data-color="#8a2be2"></div>
                        <div class="preset-color" style="background-color: #ffd166;" data-color="#ffd166"></div>
                        <div class="preset-color" style="background-color: #06d6a0;" data-color="#06d6a0"></div>
                        <div class="preset-color" style="background-color: #ff9e6d;" data-color="#ff9e6d"></div>
                    </div>
                </div>
                <div class="slider-container">
                    <i class="fas fa-adjust"></i>
                    <input type="range" id="brush-opacity" min="1" max="100" value="100">
                    <span class="slider-value" id="opacity-value">100%</span>
                </div>
            </div>

            <div class="tool-group">
                <h3><i class="fas fa-sliders-h"></i> Brush</h3>
                <div class="slider-container">
                    <i class="fas fa-ruler-combined"></i>
                    <input type="range" id="brush-size" min="1" max="40" value="10">
                    <span class="slider-value" id="brush-size-value">10px</span>
                </div>
            </div>

            <div class="tool-group">
                <h3><i class="fas fa-paint-brush"></i> Brushes</h3>
                <div class="brush-types">
                    <button class="brush-btn active" id="brush-normal" data-type="normal">
                        <div class="brush-icon"><i class="fas fa-paint-brush"></i></div>
                        <div class="brush-name">Normal</div>
                    </button>
                    <button class="brush-btn" id="brush-pixel" data-type="pixel">
                        <div class="brush-icon"><i class="fas fa-th-large"></i></div>
                        <div class="brush-name">Pixel</div>
                    </button>
                    <button class="brush-btn" id="brush-rainbow" data-type="rainbow">
                        <div class="brush-icon"><i class="fas fa-rainbow"></i></div>
                        <div class="brush-name">Rainbow</div>
                    </button>
                    <button class="brush-btn" id="brush-fur" data-type="fur">
                        <div class="brush-icon"><i class="fas fa-paw"></i></div>
                        <div class="brush-name">Fur</div>
                    </button>
                    <button class="brush-btn" id="brush-neon" data-type="neon">
                        <div class="brush-icon"><i class="fas fa-lightbulb"></i></div>
                        <div class="brush-name">Neon</div>
                    </button>
                    <button class="brush-btn" id="brush-shading" data-type="shading">
                        <div class="brush-icon"><i class="fas fa-cloud"></i></div>
                        <div class="brush-name">Shading</div>
                    </button>
                    <button class="brush-btn" id="brush-spray" data-type="spray">
                        <div class="brush-icon"><i class="fas fa-spray-can"></i></div>
                        <div class="brush-name">Spray</div>
                    </button>
                    <button class="brush-btn" id="brush-eraser" data-type="eraser">
                        <div class="brush-icon"><i class="fas fa-eraser"></i></div>
                        <div class="brush-name">Erase</div>
                    </button>
                    <button class="brush-btn" id="brush-calligraphy" data-type="calligraphy">
                        <div class="brush-icon"><i class="fas fa-pen-nib"></i></div>
                        <div class="brush-name">Calligraphy</div>
                    </button>
                    <button class="brush-btn" id="brush-glitter" data-type="glitter">
                        <div class="brush-icon"><i class="fas fa-sparkles"></i></div>
                        <div class="brush-name">Glitter</div>
                    </button>
                </div>
            </div>

            <div class="tool-group">
                <h3><i class="fas fa-sliders-h"></i> Controls</h3>
                <div class="controls">
                    <button class="btn btn-outline" id="clear-btn"><i class="fas fa-broom"></i> Clear</button>
                    <button class="btn btn-outline" id="undo-btn"><i class="fas fa-undo"></i> Undo</button>
                    <button class="btn btn-outline" id="redo-btn"><i class="fas fa-redo"></i> Redo</button>
                </div>
                <div class="hotkey-hint">Undo: Ctrl+Z | Clear: Ctrl+Del</div>
            </div>

            <div class="tool-group">
                <h3><i class="fas fa-cloud-upload-alt"></i> Export</h3>
                <div class="controls">
                    <button class="btn btn-primary" id="save-btn"><i class="fas fa-save"></i> Save</button>
                    <button class="btn btn-secondary" id="download-btn"><i class="fas fa-download"></i> Export</button>
                </div>
            </div>
        </div>

        <!-- Canvas Area -->
        <div class="canvas-area">
            <div class="canvas-header">
                <h2>Untitled Project</h2>
                <div class="canvas-actions">
                    <button class="btn btn-outline" id="new-project-btn"><i class="fas fa-plus"></i> New Project</button>
                </div>
            </div>
            <div class="canvas-container">
                <canvas id="drawing-canvas" width="800" height="600"></canvas>
                <div class="zoom-controls">
                    <div class="zoom-btn" id="zoom-in"><i class="fas fa-plus"></i></div>
                    <div class="zoom-display" id="zoom-display">100%</div>
                    <div class="zoom-btn" id="zoom-out"><i class="fas fa-minus"></i></div>
                    <div class="zoom-btn" id="reset-view"><i class="fas fa-sync"></i></div>
                </div>
            </div>
            <div class="canvas-nav">
                <div class="canvas-info">
                    <span>Brush: <span id="current-brush">Normal</span></span>
                    <span>Size: <span id="current-size">10px</span></span>
                    <span>Color: <span id="current-color">#6c5ce7</span></span>
                </div>
                <div class="canvas-actions">
                    <button class="btn btn-outline" id="grid-toggle"><i class="fas fa-th"></i> Grid</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Download Modal -->
    <div class="modal" id="download-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-download"></i> Export Artwork</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="filename">File Name</label>
                    <input type="text" id="filename" class="form-control" value="inkflow-artwork">
                </div>
                <div class="form-group">
                    <label for="file-format">Format</label>
                    <select id="file-format" class="form-control">
                        <option value="png">PNG (Recommended)</option>
                        <option value="jpg">JPG</option>
                        <option value="webp">WebP</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-download">Cancel</button>
                <button class="btn btn-primary" id="confirm-download">Download</button>
            </div>
        </div>
    </div>

    <!-- Save Modal -->
    <div class="modal" id="save-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-save"></i> Save Project</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="project-name">Project Name</label>
                    <input type="text" id="project-name" class="form-control" value="Untitled Project">
                </div>
                <div class="form-group">
                    <label for="project-description">Description (Optional)</label>
                    <textarea id="project-description" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-save">Cancel</button>
                <button class="btn btn-primary" id="confirm-save">Save Project</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-sign-in-alt"></i> Welcome to InkFlow</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" class="form-control" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" class="form-control" placeholder="Enter your password">
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" style="color: var(--primary); text-decoration: none;">Forgot password?</a>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-login">Cancel</button>
                <button class="btn btn-primary" id="confirm-login">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">Operation completed successfully!</span>
    </div>

    <script>
        // Canvas setup
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        
        // App state
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentColor = '#6c5ce7';
        let brushSize = 10;
        let brushOpacity = 1;
        let currentTool = 'normal';
        let zoomLevel = 1;
        let undoStack = [];
        let redoStack = [];
        let rainbowHue = 0;
        
        // Initialize canvas
        function initCanvas() {
            // Set initial canvas background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Save initial state
            saveState();
            
            // Set up event listeners
            setupEventListeners();
            
            // Update UI
            updateBrushInfo();
        }
        
        // Set up all event listeners
        function setupEventListeners() {
            // Canvas events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Color picker
            document.getElementById('color-picker').addEventListener('input', (e) => {
                currentColor = e.target.value;
                updateBrushInfo();
                updateActivePresetColor();
            });
            
            // Brush size
            document.getElementById('brush-size').addEventListener('input', (e) => {
                brushSize = parseInt(e.target.value);
                document.getElementById('brush-size-value').textContent = `${brushSize}px`;
                updateBrushInfo();
            });
            
            // Brush opacity
            document.getElementById('brush-opacity').addEventListener('input', (e) => {
                brushOpacity = parseInt(e.target.value) / 100;
                document.getElementById('opacity-value').textContent = `${e.target.value}%`;
            });
            
            // Brush tools
            document.querySelectorAll('.brush-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.brush-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentTool = btn.dataset.type;
                    updateBrushInfo();
                });
            });
            
            // Preset colors
            document.querySelectorAll('.preset-color').forEach(color => {
                color.addEventListener('click', (e) => {
                    document.querySelectorAll('.preset-color').forEach(c => c.classList.remove('active'));
                    color.classList.add('active');
                    currentColor = color.dataset.color;
                    document.getElementById('color-picker').value = currentColor;
                    updateBrushInfo();
                });
            });
            
            // Control buttons
            document.getElementById('clear-btn').addEventListener('click', clearCanvas);
            document.getElementById('undo-btn').addEventListener('click', undo);
            document.getElementById('redo-btn').addEventListener('click', redo);
            document.getElementById('download-btn').addEventListener('click', showDownloadModal);
            document.getElementById('save-btn').addEventListener('click', showSaveModal);
            document.getElementById('new-project-btn').addEventListener('click', newProject);
            document.getElementById('grid-toggle').addEventListener('click', toggleGrid);
            
            // Zoom controls
            document.getElementById('zoom-in').addEventListener('click', () => zoom(0.1));
            document.getElementById('zoom-out').addEventListener('click', () => zoom(-0.1));
            document.getElementById('reset-view').addEventListener('click', resetView);
            
            // Modal events
            setupModalEvents();
            
            // Auth buttons
            document.getElementById('login-btn').addEventListener('click', () => showModal('login-modal'));
            document.getElementById('register-btn').addEventListener('click', () => showModal('login-modal'));
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }
        
        // Set up modal event listeners
        function setupModalEvents() {
            // Download modal
            document.getElementById('confirm-download').addEventListener('click', downloadCanvas);
            document.getElementById('cancel-download').addEventListener('click', () => hideModal('download-modal'));
            
            // Save modal
            document.getElementById('confirm-save').addEventListener('click', saveProject);
            document.getElementById('cancel-save').addEventListener('click', () => hideModal('save-modal'));
            
            // Login modal
            document.getElementById('confirm-login').addEventListener('click', login);
            document.getElementById('cancel-login').addEventListener('click', () => hideModal('login-modal'));
            
            // Close buttons
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const modal = btn.closest('.modal');
                    hideModal(modal.id);
                });
            });
            
            // Close modal when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        hideModal(modal.id);
                    }
                });
            });
        }
        
        // Drawing functions
        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = getCoordinates(e);
            
            // Save state before drawing
            saveState();
            
            // Draw initial point for some brushes
            if (currentTool === 'spray' || currentTool === 'glitter') {
                drawPoint(lastX, lastY);
            }
        }
        
        function draw(e) {
            if (!isDrawing) return;
            
            e.preventDefault();
            
            const [x, y] = getCoordinates(e);
            
            switch(currentTool) {
                case 'normal':
                case 'calligraphy':
                    drawLine(lastX, lastY, x, y);
                    break;
                case 'pixel':
                    drawPixelLine(lastX, lastY, x, y);
                    break;
                case 'rainbow':
                    drawRainbowLine(lastX, lastY, x, y);
                    break;
                case 'fur':
                    drawFurLine(lastX, lastY, x, y);
                    break;
                case 'neon':
                    drawNeonLine(lastX, lastY, x, y);
                    break;
                case 'shading':
                    drawShadingLine(lastX, lastY, x, y);
                    break;
                case 'spray':
                    drawSpray(x, y);
                    break;
                case 'eraser':
                    drawEraserLine(lastX, lastY, x, y);
                    break;
                case 'glitter':
                    drawGlitter(x, y);
                    break;
            }
            
            [lastX, lastY] = [x, y];
        }
        
        function stopDrawing() {
            isDrawing = false;
        }
        
        function getCoordinates(e) {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left);
            const y = (e.clientY - rect.top);
            
            return [x, y];
        }
        
        // Brush drawing functions
        function drawLine(x1, y1, x2, y2) {
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.strokeStyle = currentColor;
            ctx.globalAlpha = brushOpacity;
            ctx.lineWidth = brushSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            if (currentTool === 'calligraphy') {
                // Calligraphy brush with varying width
                const gradient = ctx.createLinearGradient(x1, y1, x2, y2);
                gradient.addColorStop(0, currentColor);
                gradient.addColorStop(1, adjustColor(currentColor, -30));
                ctx.strokeStyle = gradient;
                ctx.lineWidth = brushSize * 1.5;
            }
            
            ctx.stroke();
        }
        
        function drawPixelLine(x1, y1, x2, y2) {
            // Draw pixelated line
            const steps = Math.max(Math.abs(x2 - x1), Math.abs(y2 - y1));
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const x = Math.round(x1 + (x2 - x1) * t);
                const y = Math.round(y1 + (y2 - y1) * t);
                
                ctx.fillStyle = currentColor;
                ctx.globalAlpha = brushOpacity;
                ctx.fillRect(x - brushSize/2, y - brushSize/2, brushSize, brushSize);
            }
        }
        
        function drawRainbowLine(x1, y1, x2, y2) {
            // Rainbow brush that cycles through colors
            rainbowHue = (rainbowHue + 2) % 360;
            const rainbowColor = `hsl(${rainbowHue}, 100%, 50%)`;
            
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.strokeStyle = rainbowColor;
            ctx.globalAlpha = brushOpacity;
            ctx.lineWidth = brushSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();
        }
        
        function drawFurLine(x1, y1, x2, y2) {
            // Fur brush with multiple hair-like strokes
            const steps = Math.max(Math.abs(x2 - x1), Math.abs(y2 - y1));
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const x = x1 + (x2 - x1) * t;
                const y = y1 + (y2 - y1) * t;
                
                // Draw multiple hair-like strokes
                for (let j = 0; j < 3; j++) {
                    const angle = Math.random() * Math.PI * 2;
                    const length = brushSize * 0.5 + Math.random() * brushSize;
                    const endX = x + Math.cos(angle) * length;
                    const endY = y + Math.sin(angle) * length;
                    
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(endX, endY);
                    ctx.strokeStyle = currentColor;
                    ctx.globalAlpha = brushOpacity * 0.7;
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            }
        }
        
        function drawNeonLine(x1, y1, x2, y2) {
            // Neon brush with glow effect
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            
            // Outer glow
            ctx.shadowBlur = 15;
            ctx.shadowColor = currentColor;
            ctx.strokeStyle = currentColor;
            ctx.globalAlpha = brushOpacity * 0.7;
            ctx.lineWidth = brushSize + 4;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();
            
            // Inner line
            ctx.shadowBlur = 0;
            ctx.strokeStyle = lightenColor(currentColor, 40);
            ctx.globalAlpha = brushOpacity;
            ctx.lineWidth = brushSize;
            ctx.stroke();
        }
        
        function drawShadingLine(x1, y1, x2, y2) {
            // Shading brush with soft edges
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            
            // Create gradient for soft edges
            const gradient = ctx.createLinearGradient(x1, y1, x2, y2);
            gradient.addColorStop(0, currentColor);
            gradient.addColorStop(0.5, adjustColor(currentColor, -20));
            gradient.addColorStop(1, currentColor);
            
            ctx.strokeStyle = gradient;
            ctx.globalAlpha = brushOpacity * 0.8;
            ctx.lineWidth = brushSize * 1.5;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();
        }
        
        function drawSpray(x, y) {
            // Spray paint effect
            const density = brushSize * 2;
            for (let i = 0; i < density; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.random() * brushSize;
                const sprayX = x + Math.cos(angle) * radius;
                const sprayY = y + Math.sin(angle) * radius;
                
                ctx.fillStyle = currentColor;
                ctx.globalAlpha = brushOpacity * 0.3;
                ctx.fillRect(sprayX, sprayY, 1, 1);
            }
        }
        
        function drawEraserLine(x1, y1, x2, y2) {
            // Eraser tool
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.strokeStyle = '#ffffff';
            ctx.globalAlpha = 1;
            ctx.lineWidth = brushSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();
        }
        
        function drawGlitter(x, y) {
            // Glitter effect with random sparkles
            const density = brushSize;
            for (let i = 0; i < density; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.random() * brushSize;
                const glitterX = x + Math.cos(angle) * radius;
                const glitterY = y + Math.sin(angle) * radius;
                
                // Random glitter color (lighter version of current color)
                const glitterColor = lightenColor(currentColor, Math.random() * 50);
                
                ctx.fillStyle = glitterColor;
                ctx.globalAlpha = brushOpacity * 0.8;
                ctx.fillRect(glitterX, glitterY, 2, 2);
            }
        }
        
        function drawPoint(x, y) {
            // Draw a single point (used for spray and glitter on mousedown)
            if (currentTool === 'spray') {
                drawSpray(x, y);
            } else if (currentTool === 'glitter') {
                drawGlitter(x, y);
            }
        }
        
        // Color utility functions
        function adjustColor(color, amount) {
            // Adjust color brightness
            let usePound = false;
            if (color[0] === "#") {
                color = color.slice(1);
                usePound = true;
            }
            
            const num = parseInt(color, 16);
            let r = (num >> 16) + amount;
            if (r > 255) r = 255;
            else if (r < 0) r = 0;
            
            let b = ((num >> 8) & 0x00FF) + amount;
            if (b > 255) b = 255;
            else if (b < 0) b = 0;
            
            let g = (num & 0x0000FF) + amount;
            if (g > 255) g = 255;
            else if (g < 0) g = 0;
            
            return (usePound ? "#" : "") + (g | (b << 8) | (r << 16)).toString(16).padStart(6, '0');
        }
        
        function lightenColor(color, percent) {
            // Lighten a color by a percentage
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            
            return "#" + (
                0x1000000 +
                (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
                (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
                (B < 255 ? (B < 1 ? 0 : B) : 255)
            ).toString(16).slice(1);
        }
        
        // Canvas controls
        function clearCanvas() {
            if (confirm('Are you sure you want to clear the canvas?')) {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                saveState();
                showNotification('Canvas cleared');
            }
        }
        
        function saveState() {
            undoStack.push(canvas.toDataURL());
            if (undoStack.length > 50) {
                undoStack.shift();
            }
            redoStack = [];
        }
        
        function undo() {
            if (undoStack.length > 1) {
                redoStack.push(undoStack.pop());
                const img = new Image();
                img.onload = function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
                img.src = undoStack[undoStack.length - 1];
                showNotification('Undo completed');
            }
        }
        
        function redo() {
            if (redoStack.length > 0) {
                const img = new Image();
                img.onload = function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
                img.src = redoStack.pop();
                undoStack.push(img.src);
                showNotification('Redo completed');
            }
        }
        
        // Zoom and pan functions
        function zoom(delta) {
            zoomLevel += delta;
            zoomLevel = Math.max(0.1, Math.min(5, zoomLevel));
            updateCanvasTransform();
            document.getElementById('zoom-display').textContent = `${Math.round(zoomLevel * 100)}%`;
        }
        
        function resetView() {
            zoomLevel = 1;
            updateCanvasTransform();
            document.getElementById('zoom-display').textContent = '100%';
        }
        
        function updateCanvasTransform() {
            canvas.style.transform = `scale(${zoomLevel})`;
        }
        
        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function showDownloadModal() {
            showModal('download-modal');
        }
        
        function downloadCanvas() {
            const filename = document.getElementById('filename').value || 'inkflow-artwork';
            const format = document.getElementById('file-format').value;
            
            const link = document.createElement('a');
            link.download = `${filename}.${format}`;
            link.href = canvas.toDataURL(`image/${format}`);
            link.click();
            
            hideModal('download-modal');
            showNotification('Artwork downloaded successfully!');
        }
        
        function showSaveModal() {
            showModal('save-modal');
        }
        
        function saveProject() {
            const projectName = document.getElementById('project-name').value;
            
            // In a real app, you would save to a database or local storage
            // For now, we'll just show a notification
            hideModal('save-modal');
            showNotification(`Project "${projectName}" saved successfully!`);
        }
        
        function newProject() {
            if (confirm('Start a new project? Any unsaved changes will be lost.')) {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                saveState();
                showNotification('New project created');
            }
        }
        
        function toggleGrid() {
            // This would toggle a grid overlay in a real implementation
            showNotification('Grid toggled');
        }
        
        function login() {
            const email = document.getElementById('login-email').value;
            
            if (!email) {
                showNotification('Please enter your email', 'error');
                return;
            }
            
            // In a real app, you would authenticate with a server
            hideModal('login-modal');
            showNotification(`Welcome back! Signed in as ${email}`);
            
            // Update UI for logged in state
            document.getElementById('login-btn').textContent = 'My Account';
            document.getElementById('register-btn').style.display = 'none';
        }
        
        // UI update functions
        function updateBrushInfo() {
            document.getElementById('current-brush').textContent = currentTool.charAt(0).toUpperCase() + currentTool.slice(1);
            document.getElementById('current-size').textContent = `${brushSize}px`;
            document.getElementById('current-color').textContent = currentColor;
        }
        
        function updateActivePresetColor() {
            document.querySelectorAll('.preset-color').forEach(color => {
                if (color.dataset.color === currentColor) {
                    color.classList.add('active');
                } else {
                    color.classList.remove('active');
                }
            });
        }
        
        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notification-text');
            
            text.textContent = message;
            notification.className = 'notification';
            notification.classList.add(type);
            notification.style.display = 'flex';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Keyboard shortcuts
        function handleKeyboardShortcuts(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'z':
                        e.preventDefault();
                        undo();
                        break;
                    case 'y':
                        e.preventDefault();
                        redo();
                        break;
                    case 's':
                        e.preventDefault();
                        showSaveModal();
                        break;
                    case 'd':
                        e.preventDefault();
                        showDownloadModal();
                        break;
                }
            }
            
            if (e.key === 'Delete' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                clearCanvas();
            }
        }
        
        // Initialize the app when the page loads
        window.addEventListener('load', initCanvas);
    </script>
</body>
</html>
